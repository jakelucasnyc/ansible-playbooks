hosts: all
become: true
tasks:
  - name: Install aptitude
    apt:
      name: aptitude
      state: latest
      update_cache: true

  - name: Install required system packages
    apt:
      pkg:
        - ca-certificates
        - curl
      state: latest
      update_cache: true

  - name: Install keyrings
    become: true
    ansible.builtin.shell:
      cmd: install -m 0755 -d /etc/apt/keyrings

  - name: Download Docker GPG Key
    become: true
    ansible.builtin.shell:
      cmd: curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc

  - name: Change Docker GPG Key Permissions
    become: true
    ansible.builtin.shell:
      cmd: chmod a+r /etc/apt/keyrings/docker.asc

  - name: Add Docker to Apt Sources
    become: true
    ansible.builtin.shell:
      cmd: echo \ "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

  - name: Update Apt
    apt:
      pkg:
        - docker-ce
        - docker-ce-cli
        - containerd.io
        - docker-buildx-plugin 
        - docker-compose-plugin
      update_cache: true

  - name: Create Docker Hello World
    community.docker.docker_container:
      name: hello-world
      image: hello-world
  
